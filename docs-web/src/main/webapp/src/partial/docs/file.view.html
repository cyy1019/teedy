<div class="text-center">
  <div class="btn-group pull-left">
    <button type="button" class="btn btn-default" ng-click="closeFile()">
      <span class="fas fa-times"></span>
    </button>
  </div>

  <div class="btn-group">
    <button type="button" class="btn btn-default"
            ng-style="{ 'visibility': previousFile() ? 'visible' : 'hidden' }"
            ng-click="goPreviousFile()">
      {{ 'file.view.previous' | translate }}
    </button>
    <button type="button" class="btn btn-default"
            ng-style="{ 'visibility': nextFile() ? 'visible' : 'hidden' }"
            ng-click="goNextFile()">
      {{ 'file.view.next' | translate }}
    </button>
    <button type="button" class="btn btn-placeholder" style="visibility: hidden">
      &nbsp;
    </button>
  </div>
  
  <div class="btn-group pull-right">
    <!-- Translation button and dropdown -->
    <div class="btn-group" uib-dropdown>
      <button type="button" class="btn btn-default" uib-dropdown-toggle>
        <span class="fas fa-language"></span>
        {{ 'file.view.translate' | translate }}
      </button>
      <ul class="dropdown-menu" uib-dropdown-menu>
        <li ng-repeat="lang in supportedLanguages">
          <a href ng-click="translateFile(lang.code)">
            {{ lang.name }}
          </a>
        </li>
      </ul>
    </div>
    
    <button type="button" class="btn btn-default" uib-tooltip="Print this file" tooltip-append-to-body="true" ng-click="printFile()">
      <span class="fas fa-print"></span>
    </button>
    <button type="button" class="btn btn-default" uib-tooltip="Download this file" tooltip-append-to-body="true" ng-click="openFile()">
      <span class="fas fa-download"></span>
    </button>
    <button type="button" class="btn btn-default" uib-tooltip="Show text content" tooltip-append-to-body="true" ng-click="openFileContent()">
      <span class="fas fa-eye"></span>
    </button>
  </div>
</div>

<!-- File content display -->
<div class="file-content-container">
  <div class="alert alert-danger" ng-if="translationError">
    {{ translationError }}
  </div>
  
  <div class="file-content" ng-if="!translationResult">
    <pre>{{ fileContent }}</pre>
  </div>
  
  <div class="translation-result" ng-if="translationResult">
    <h4>{{ 'file.view.translation_result' | translate }}:</h4>
    <pre>{{ translationResult }}</pre>
  </div>
  
  <div class="loading-spinner" ng-if="isTranslating">
    <span class="fas fa-spinner fa-spin"></span> {{ 'file.view.translating' | translate }}
  </div>
</div>

<style>
.file-content-container {
  margin: 20px;
  padding: 20px;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.file-content, .translation-result {
  margin-top: 20px;
}

.file-content pre, .translation-result pre {
  white-space: pre-wrap;
  word-wrap: break-word;
  background-color: #f8f9fa;
  padding: 15px;
  border-radius: 4px;
}

.loading-spinner {
  text-align: center;
  margin: 20px 0;
  color: #666;
}
</style>

<div class="text-center" style="position: relative;" ng-if="$stateParams.fileId">
  <!-- <div class="translation-result" ng-if="translationResult || translationError">
    <div class="alert alert-danger" ng-if="translationError">
      {{ translationError }}
    </div>
    <div class="alert alert-success" ng-if="translationResult">
      <strong>{{ 'file.view.translation_result' | translate }}:</strong>
      <p>{{ translationResult }}</p>
    </div>
  </div> -->

  <!-- Standard preview -->
  <img ng-src="../api/file/{{ $stateParams.fileId }}/data?size=web"
       ng-init="error = false"
       img-error="error = true"
       ng-show="!error && canDisplayPreview()" />

  <!-- Media player -->
  <a href class="video-overlay" ng-if="!error && (file.mimetype.substring(0, 6) == 'video/' || file.mimetype.substring(0, 6) == 'audio/')"
     ng-init="videoPlayer = false" ng-click="videoPlayer = true">
    <span class="fas fa-play-circle" ng-if="!videoPlayer"></span>
    <video ng-if="videoPlayer" autoplay="autoplay" loop="loop"
           controls="controls" ng-src="../api/file/{{ $stateParams.fileId }}/data"></video>
  </a>

  <!-- PDF viewer -->
  <iframe ng-src="{{ trustedFileUrl }}" class="pdf-viewer" scrolling="yes" ng-if="!error && file.mimetype == 'application/pdf'"></iframe>

  <!-- File not found -->
  <p class="well-lg" ng-show="error">
    <span class="fas fa-exclamation-triangle"></span>
    {{ 'file.view.not_found' | translate }}
  </p>
</div>
